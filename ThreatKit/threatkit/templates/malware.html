{% extends "base.html" %}
{% block title %}ThreatKit — Malware Checker{% endblock %}
{% from "components/score_meter.html" import score_meter %}


{% block content %}
<div class="container my-5">

  <h1 class="h4 mb-2">Malware Checker</h1>
  <p class="text-secondary mb-4">
    Upload a file to scan with our static ML model and YARA rules. Never upload sensitive files.
  </p>

  <!-- Upload form -->
  <form action="{{ url_for('malware.scan_file') }}" method="post" enctype="multipart/form-data" class="mb-3">
    <div class="input-group">
      <input class="form-control" type="file" name="file" required>
      <button class="btn btn-accent" type="submit">Upload</button>
    </div>
  </form>

  <!-- Flash messages (errors, etc.) -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-warning mt-2 mb-0 small">
        {% for message in messages %}
          {{ message }}<br>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Results card -->
  {% if result %}
  <div class="row g-4 mt-1">
    <div class="col-md-6">
      <div class="tk-card">
        {{ score_meter(result.score_5|int, 5, result.score_label ~ " — " ~ result.prediction) }}
        <div class="mt-3 tk-subtle small">
          Combined risk: {{ result.combined }} · ML prob: {{ result.ml }} · YARA: {{ result.yara }}
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="tk-card">
        <div class="fw-semibold mb-2">YARA Signatures</div>
        {% if result.rules and result.rules|length > 0 %}
          <div class="d-flex flex-wrap gap-2">
            {% for rule in result.rules %}
              <span class="tk-chip">{{ rule.replace('_',' ') }}</span>
            {% endfor %}
          </div>
        {% else %}
          <div class="tk-subtle">No YARA signatures were triggered for this file.</div>
        {% endif %}

        <div class="tk-sep my-3"></div>
        <div class="small tk-subtle">
          Lower scores (1–2) usually indicate higher suspicion; higher scores (4–5) indicate benign files.
        </div>
      </div>
    </div>
  </div>
{% endif %}


</div>
{% endblock %}
