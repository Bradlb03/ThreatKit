{% extends "base.html" %}
{% block title %}ThreatKit — Malware Checker{% endblock %}

{% block content %}
<div class="container my-5">

  <h1 class="h4 mb-2">Malware Checker</h1>
  <p class="text-secondary mb-4">
    Upload a file to scan with our static ML model and YARA rules.
  </p>

  <!-- Upload form -->
  <form action="{{ url_for('malware.scan_file') }}" method="post" enctype="multipart/form-data" class="mb-3">
    <div class="input-group">
      <input class="form-control" type="file" name="file" required>
      <button class="btn btn-accent" type="submit">Upload</button>
    </div>
  </form>

  <!-- Flash messages (errors, etc.) -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="alert alert-warning mt-2 mb-0 small">
        {% for message in messages %}
          {{ message }}<br>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Results card -->
  {% if result %}
  <div class="card bg-surface mt-4">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <h6 class="{{ result.score_color }} mb-1">
            {{ result.score_label }} — {{ result.prediction }}
          </h6>
          <p class="mb-1 small text-muted">
            Combined Risk: {{ result.combined }} · ML Probability: {{ result.ml }} · YARA Match Score: {{ result.yara }}
          </p>
          <p class="mb-0 small text-muted">
            Lower scores (1–2) usually indicate higher suspicion; higher scores (4–5) indicate benign files.
          </p>
        </div>
        <div class="text-end">
          <div class="fw-semibold small text-muted">
            Score {{ result.score_5 }} / 5
          </div>
        </div>
      </div>

      <hr class="my-3" />

      {% if result.rules and result.rules|length > 0 %}
        <p class="small mb-2">These signatures contributed to the risk assessment:</p>
        <ul class="small mb-0">
          {% for rule in result.rules %}
          <li>{{ rule.replace('_', ' ') }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="small mb-0 text-muted">
          No YARA signatures were triggered for this file.
        </p>
      {% endif %}
    </div>
  </div>
  {% endif %}

</div>
{% endblock %}
