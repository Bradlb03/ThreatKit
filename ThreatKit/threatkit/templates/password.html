{% extends "base.html" %}
{% from "components/score_meter.html" import score_meter %}
{% block title %}ThreatKit — Password Checker{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Password Checker</h1>

<form method="POST" class="tk-card" autocomplete="off">
  <label for="pw" class="form-label">Enter a password to evaluate</label>
  <div class="input-group mb-3">
    <input
      id="pw"
      name="password"
      type="password"
      class="form-control tk-input"
      placeholder="CorrectHorseBatteryStaple"
      required
      minlength="4"
      maxlength="72"
      aria-describedby="pwHelp"
    />
    <button class="btn btn-accent" type="submit">Scan</button>
  </div>
  <div id="pwHelp" class="form-text tk-subtle">
    Never enter your University or any other existing password. We do not store passwords, they are processed in memory only.
  </div>

  {% if result %}
    <hr class="tk-sep my-3" />

    <div class="row g-4">
      <div class="col-md-6">
        <div class="tk-card">
          {{ score_meter(result.score, 5, result.label) }}
        </div>
      </div>

      <div class="col-md-6">
        <div class="tk-card">
          <div class="fw-semibold mb-2">Suggestions</div>
          <ul class="mb-0 tk-subtle">
            {% if result.suggestions and result.suggestions|length %}
              {% for s in result.suggestions %}
                <li>{{ s }}</li>
              {% endfor %}
            {% else %}
              <li>Use multiple unrelated words</li>
              <li>Avoid repeats and keyboard walks</li>
              <li>Aim for a score of 4–5</li>
            {% endif %}
            {% if result.warning %}
              <li><strong>Warning:</strong> {{ result.warning }}</li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>

    <div class="tk-card mt-4">
      <div class="fw-semibold mb-2">AI Analysis Summary</div>
      <div id="ai-summary" class="tk-subtle" style="white-space: pre-wrap;">
        <em>Loading AI analysis...</em>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const summaryBox = document.getElementById("ai-summary");

        fetch("{{ url_for('password.ai_summary') }}", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ password: "{{ result.input_password }}" })
        })
        .then(res => res.json())
        .then(data => {
          summaryBox.textContent = data.summary || "No response.";
        })
        .catch(err => {
          summaryBox.textContent = "Error loading AI analysis.";
        });
      });
    </script>

  {% endif %}
</form>
{% endblock %}