{% extends "base.html" %}
{% block title %}ThreatKit — Phishing Email Checker{% endblock %}

{% block content %}
<h1 class="h4 mb-3">Phishing Email Checker</h1>
<p class="text-secondary mb-4">
  Higher score = safer. 5 = very safe, 0 = phishing.
</p>

<form method="POST" class="vstack gap-3">
  <div>
    <label class="form-label">Sender (From)</label>
    <input name="from" class="form-control" required />
  </div>

  <div>
    <label class="form-label">Return-Path (optional)</label>
    <input name="return_path" class="form-control" />
  </div>

  <div>
    <label class="form-label">Subject</label>
    <input name="subject" class="form-control" />
  </div>

  <div>
    <label class="form-label">Body</label>
    <textarea name="body" class="form-control" rows="10"></textarea>
  </div>

  <div class="d-flex gap-2">
    <button type="submit" class="btn btn-primary">Analyze</button>
    <a href="{{ url_for('emailcheck.phishing_page') }}" class="btn btn-outline-secondary">Clear</a>
  </div>
</form>

{% if result %}
  <hr class="my-4" />
  <div class="card shadow-sm">
    <div class="card-body">
      <h2 class="h5 mb-3 d-flex align-items-center gap-2">
        <span>Safety Score: {{ result.risk_score }} / 5</span>

        {% if result.category == 'Safe' %}
          <span class="badge text-bg-success">SAFE</span>
        {% elif result.category == 'Likely Phishing' %}
          <span class="badge text-bg-warning">Likely Phishing</span>
        {% else %}
          <span class="badge text-bg-danger">PHISHING</span>
        {% endif %}
      </h2>

      {% if result.ml and not result.ml.error %}
        <p class="mb-1 text-secondary">
          Model: {{ (result.ml.confidence * 100)|round(1) }}% ({{ result.ml.prediction }})
        </p>
      {% elif result.ml and result.ml.error %}
        <p class="mb-1 text-warning">Model error — rules only: {{ result.ml.error }}</p>
      {% endif %}

      {% if result.key_indicators and result.key_indicators|length > 0 %}
        <h3 class="h6 mt-3">Indicators</h3>
        <ul class="mb-0">
          {% for ex in result.key_indicators %}
            <li>{{ ex }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-secondary mt-3 mb-0">No strong indicators found.</p>
      {% endif %}
    </div>
  </div>
{% endif %}
{% endblock %}